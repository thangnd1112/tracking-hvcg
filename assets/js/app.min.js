function resets(){window.location.reload()}function handleClientLoad(){gapi.load("client:auth2",initClient)}function getApi(t){var e=/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/,n=t.match(e);void 0===gettedToken[0].zc&&($(".popup").show(),$(".popup p").html("Access token không hợp lệ!"),$(".popup button").hide());var o="https://sheets.googleapis.com/v4/spreadsheets/"+n[1]+"/values/Trang%20tính1?alt=json&access_token="+gettedToken[0].zc.access_token;return o}function initClient(){var t="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest";gapi.client.init({apiKey:"AIzaSyA-5v9hrBZt8gYxKqet-Of90cCPNLHGAnk",clientId:"385356524753-f4bficgqsm0sb1ggfma7trp6bimp1bo8.apps.googleusercontent.com",discoveryDocs:[t],scope:SCOPE}).then(function(){function t(){let t,e=[],n=[];setStatusLoading(),$.getJSON(link_total_url_api,function(o){t=o.values;for(let n=1;n<t.length;n++)"Đang Học"==t[n][3]&&e.push(t[n]);for(let t=0;t<e.length;t++)n.push(e[t][0])}).done(function(t,o,a){removeTableRows(),clearTimeouts(),callAPIOnInterval(5,n,e)})}GoogleAuth=gapi.auth2.getAuthInstance(),GoogleAuth.isSignedIn.listen(updateSigninStatus);var e=GoogleAuth.currentUser.get();setSigninStatus(),gettedToken.push(e),$("#sign-in-or-out-button").click(function(){handleAuthClick()}),$("#revoke-access-button").click(function(){revokeAccess()});var n="https://docs.google.com/spreadsheets/d/1sx2NMPFL7QLPeRMAJvysJj82c74ARS1qMrgSfwc3Xcg/edit#gid=0";link_total_url_api=getApi(n),$.getJSON(link_total_url_api,function(t){let e=[],n=[];for(var o=t.values,a=1;a<o.length;a++)e.push(o[a][1]);n=e.filter(function(t,n){return e.indexOf(t)===n}),n.sort()}).done(()=>window.filterOnNewTab?filter():t())})}function filter(){window.filterOnNewTab=!1;let t=[],e=[],n=[],o=[];setStatusLoading(),$.getJSON(link_total_url_api,function(a){for(var r=a.values,l=1;l<r.length;l++)e.push(r[l][1]);o=e.filter(function(t,n){return e.indexOf(t)===n}),r.map(e=>{"Đang Học"===e[3]&&e[1]==filterBy[1]&&t.push(e)});for(l=0;l<t.length;l++)n.push(t[l][0])}).done(function(){removeTableRows(),clearTimeouts(),callAPIOnInterval(5,n,t)})}function callAPIOnInterval(t,e,n,o=0){let a=[];for(let r=o;r<=t&&r<e.length;r++){r==t&&timeouts.push(setTimeout(()=>callAPIOnInterval(t+3,e,n,r+1),7e3)),0===o&&(allTableRows=[]);let l=getApi(e[r]);a.push($.getJSON(l,{},function(t){let e=[];for(let n=0;n<t.values.length;n++){var o=Date.parse(t.values[n][2]);0==isNaN(o)&&e.push(t.values[n][2])}n[r].i4=t.values[3][8],n[r].h4=t.values[3][7],n[r].e4=t.values[3][4],n[r].last_teaching_day=e[e.length-1]}).done(()=>{count++,$(".progress-bar-label").text(`${parseInt(count/n.length*100)}%`),$(".progress-bar-label").css("width",`${parseInt(count/n.length*100)}%`),$("#percent").text(`${parseInt(count/n.length*100)}%`)}).fail(()=>{$(".popup").show()}))}$.when(...a,o).then(function(){if(renderTable(o,n),e.length==e.length){sortTable("theTimeLeft")}})}function renderTable(t,e){var n=0,o=0;for(let i=t;i<e.length;i++){o++,e[i][4]=Number(e[i][4]),hoursPaid=e[i][4];var a=e[i].i4;void 0!==a&&(a=a.replace(",",".")),e[i].total_hour_learned=a;var r=Math.floor(a-hoursPaid)*e[i][6];e[i].totalSalaryPerClass=r;var l=Math.round(1e3*(e[i].h4-a))/1e3;e[i].theTimeLeft=l;var s=Math.floor(1e3*(a-hoursPaid)/1e3);e[i].hoursToPay=s,n+=r,allTableRows=allTableRows.concat(e.filter(t=>allTableRows.indexOf(t)<0)),renderTableRow(e[i],i),void 0!==a&&(document.getElementById("filter"+i).onclick=function(){var t=window.open(window.location.href,"_blank");t.filterOnNewTab=!0,t.filterBy=e[i],t.focus()},document.getElementById("filter"+i).onclick=function(){var t=window.open(window.location.href,"_blank");t.filterOnNewTab=!0,t.filterBy=e[i],t.focus()})}var i=document.getElementById("totalSalary");isNaN(n)||window.filterOnNewTab?i.innerHTML="":(i.innerHTML="Tổng Lương : "+n,setStatusDone(o))}function renderTableRow(t,e){void 0!==t.e4&&$("#table tbody").append("<tr><td>"+`<span id="filter${e}">`+t.e4+"</span></td><td>"+`<a href="${t[0]}" target="_blank">`+t[2]+"</a></td><td>"+`<a id="linkFb-${e}" href="${t[5]}" target="_blank"><?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg width="25" height="25" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M0 24C0 10.7452 10.7452 0 24 0C37.2548 0 48 10.7452 48 24C48 37.2548 37.2548 48 24 48C10.7452 48 0 37.2548 0 24Z" fill="#3B5998"/>\n<path d="M26.5015 38.1115V25.0542H30.1059L30.5836 20.5546H26.5015L26.5077 18.3025C26.5077 17.1289 26.6192 16.5001 28.3048 16.5001H30.5581V12H26.9532C22.6231 12 21.0991 14.1828 21.0991 17.8536V20.5551H18.4V25.0547H21.0991V38.1115H26.5015Z" fill="white"/>\n</svg></a>`+"</td><td>"+t.total_hour_learned+"</td><td>"+t.h4+`</td><td id="timeleft-${e}">`+t.theTimeLeft+"</td><td>"+t[4]+"</td><td>"+t.hoursToPay+"</td><td>"+t.last_teaching_day+"</td><td>"+t[6]+"</td><td>"+t.totalSalaryPerClass+"</td></tr>");var n=Number($(`#timeleft-${e}`).text()),o=$(`#linkFb-${e}`);n<=3&&$(`#timeleft-${e}`).css({color:"red","font-weight":"bold"}),""==o.attr("href")&&o.hide()}function sortTable(t="i4"){allTableRows.sort(function(e,n){return e=e[t],n=n[t],ascSortOrder?e<n?-1:e>n?1:0:e>n?-1:e<n?1:0}),removeTableRows(),renderTable(0,allTableRows)}function clearTimeouts(){for(var t=0;t<timeouts.length;t++)clearTimeout(timeouts[t]);timeouts=[]}function removeTableRows(){$("#table tbody").empty()}function setStatusLoading(){$("#status").html(' \n      <div class="isLoading fs-18">Đang tải dữ liệu</div>\n      <div id="loader-container">\n        <div style="margin-top: 5px;"class="loader"></div>\n        <div id="percent"></div>\n      </div>\n      ')}function setStatusDone(t){$("#status").html(`Truy vấn thành công ${t} kết quả.`),$(".progress-bar-label").hide()}function handleAuthClick(){GoogleAuth.isSignedIn.get()?GoogleAuth.signOut():GoogleAuth.signIn()}function revokeAccess(){GoogleAuth.disconnect()}function setSigninStatus(){var t=GoogleAuth.currentUser.get(),e=t.hasGrantedScopes(SCOPE);e?($("#sign-in-or-out-button").html("Sign out"),$("#revoke-access-button").css("display","inline-block"),$("#auth-status").html("Đăng nhập thành công")):($("#sign-in-or-out-button").html("Sign In/Authorize"),$("#revoke-access-button").css("display","none"),$("#auth-status").html("Xin vui lòng đăng nhập"))}function updateSigninStatus(){setSigninStatus()}var GoogleAuth,link_total_url_api,SCOPE="https://www.googleapis.com/auth/spreadsheets",gettedToken=[],timeouts=[],allTableRows=[];let count=0;var ascSortOrder=!0;$("#btn-sort-1").click(function(){ascSortOrder=!ascSortOrder,sortTable("i4")}),$("#btn-sort-2").click(function(){ascSortOrder=!ascSortOrder,sortTable("h4")}),$("#btn-sort-3").click(function(){ascSortOrder=!ascSortOrder,sortTable("theTimeLeft")}),$("#btn-sort-4").click(function(){ascSortOrder=!ascSortOrder,sortTable(4)}),$("#btn-sort-5").click(function(){ascSortOrder=!ascSortOrder,sortTable("hoursToPay")}),$("#btn-sort-by-student").click(function(){ascSortOrder=!ascSortOrder,sortTable(2)}),$("#btn-sort-by-mentor").click(function(){ascSortOrder=!ascSortOrder,sortTable(1)}),$("#btn-sort-last-day").click(function(){ascSortOrder=!ascSortOrder,sortTable("last_teaching_day")}),$("#btn-sort-salary").click(function(){ascSortOrder=!ascSortOrder,sortTable(6)}),$("#btn-sort-total-salary").click(function(){ascSortOrder=!ascSortOrder,sortTable("totalSalaryPerClass")});